<?xml version="1.0" encoding="GB2312"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans default-autowire="byName">
    <!-- ===================== include processor===================== -->
    <import resource="processor.xml" />
	<!-- ===================== for webServer ======================= -->
	<bean id="render" class="com.dianping.cat.notify.render.VelocityRender"  init-method="init"/>
	<bean id="configContext" class="com.dianping.cat.notify.config.ConfigContext" />
	<bean id="webServer" class="com.dianping.cat.notify.server.WebServer" init-method="init" />
	<bean id="mainServlet" class="com.dianping.cat.notify.server.MainServlet" />
	<!-- ===================== for scheduleJobRunner ======================= -->
	<bean id="scheduleJobRunner" class="com.dianping.cat.notify.job.StandardScheduleJobRunner" >
	    <property name="config">
			<ref bean="configContext" />
		</property>
		<property name="jobs">
		    <list>
		       <ref bean="sendMailJob"/>
		    </list>
		</property>
    </bean>
    <bean id="sendMailJob" class="com.dianping.cat.notify.job.SendReportMailJob"></bean>
	<!-- ===================== for Data persistence layer================ -->
	<bean id="baseDao" class="com.dianping.cat.notify.dao.ibatisimpl.BaseDao">
		<property name="dataSource">
			<ref bean="dataSource" />
		</property>
		<property name="sqlMapClient">
			<ref bean="sqlMapClientChat" />
		</property>
	</bean>
	<bean id="transactionManager"
		class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="dataSource" />
	</bean>
	<bean id="sqlMapClientChat" class="org.springframework.orm.ibatis.SqlMapClientFactoryBean">
		<property name="dataSource">
			<ref bean="dataSource" />
		</property>
		<property name="configLocation">
			<value>classpath:ibatis/SqlMap.xml</value>
		</property>
	</bean>
	<bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"
		destroy-method="close">
		<property name="jdbcUrl" value="jdbc:mysql://192.168.7.43:3306/cat?characterEncoding=UTF-8" />
		<property name="user" value="dpcom_cat" />
		<property name="password" value="password" />
		<property name="driverClass" value="com.mysql.jdbc.Driver" />
		<property name="minPoolSize" value="2" />
		<property name="maxPoolSize" value="20" />
		<property name="initialPoolSize" value="2" />
		<property name="maxIdleTime" value="1800" />
		<property name="idleConnectionTestPeriod" value="60" />
		<property name="acquireRetryAttempts" value="3" />
		<property name="acquireRetryDelay" value="300" />
		<property name="maxStatements" value="0" />
		<property name="maxStatementsPerConnection" value="100" />
		<property name="numHelperThreads" value="6" />
		<property name="maxAdministrativeTaskTime" value="5" />
		<property name="preferredTestQuery" value="SELECT 1" />
	</bean>
	<bean id="mailLogDao" class="com.dianping.cat.notify.dao.ibatisimpl.MailLogDaoImp" >
	     <property name="baseDao" ref="baseDao"></property>
	</bean>
	<bean id="subscriberDao" class="com.dianping.cat.notify.dao.ibatisimpl.SubscriberDaoImp" >
	     <property name="baseDao" ref="baseDao"></property>
	</bean>
	<bean id="dailyReportDao" class="com.dianping.cat.notify.dao.ibatisimpl.DailyReportDaoImp" >
	     <property name="baseDao" ref="baseDao"></property>
	</bean>
	<!-- ===================== for pigeon service================ -->
    <bean name="placeholder" lazy-init="false" class="com.dianping.lion.client.InitializeConfig">
		<property name="propertiesPath" value="applicationContext.properties"/>
	</bean>
	<bean id="commonService" class="com.dianping.dpsf.spring.ProxyBeanFactory" init-method="init">
		<property name="serviceName" value="http://service.dianping.com/hawk/alarm/commonAlarmSerivce"/>
		<property name="iface" value="com.dianping.hawk.common.alarm.service.CommonAlarmService"/>
		<property name="serialize" value="hessian"/>
		<property name="callMethod" value="sync"/>
		<property name="timeout" value="10000"/>
	</bean>
</beans>